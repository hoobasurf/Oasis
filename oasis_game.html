<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>DREAMY STAR âœ¨</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@800;900&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;}
html,body{width:100%;height:100%;overflow:hidden;background:#87CEEB;font-family:'Nunito',sans-serif;}
#gc{display:block;position:fixed;top:0;left:0;touch-action:none;}
#hud{position:fixed;top:0;left:0;width:100%;pointer-events:none;z-index:10;padding:10px 14px;display:flex;align-items:center;justify-content:space-between;}
.chip{background:rgba(255,255,255,0.95);border-radius:50px;padding:7px 18px;font-size:14px;font-weight:900;color:#C03060;box-shadow:0 3px 14px rgba(0,0,0,0.15);border:2px solid rgba(255,180,200,0.5);display:flex;align-items:center;gap:5px;}
.chip .v{color:#E0307A;font-size:16px;}
#game-title{font-family:'Fredoka One',cursive;font-size:22px;color:#FF5FA0;text-shadow:0 2px 8px rgba(255,100,150,0.4);letter-spacing:2px;}
#zonech{position:fixed;top:54px;left:50%;transform:translateX(-50%);font-family:'Fredoka One',cursive;font-size:12px;background:rgba(255,255,255,0.9);border-radius:30px;padding:5px 16px;color:#805030;border:2px solid rgba(255,200,140,0.5);pointer-events:none;z-index:10;white-space:nowrap;}
#notif{position:fixed;top:38%;left:50%;transform:translate(-50%,-50%);font-family:'Fredoka One',cursive;font-size:30px;color:#FF5FA0;text-align:center;pointer-events:none;opacity:0;z-index:60;text-shadow:0 2px 12px rgba(255,100,150,0.6);white-space:nowrap;}
#jzone{position:fixed;bottom:30px;left:18px;width:120px;height:120px;z-index:30;display:none;touch-action:none;}
#jbase{position:absolute;inset:0;border-radius:50%;background:rgba(255,255,255,0.2);border:3px solid rgba(255,255,255,0.45);}
#jknob{position:absolute;width:46px;height:46px;top:50%;left:50%;transform:translate(-50%,-50%);border-radius:50%;background:radial-gradient(circle at 38% 35%,#fff,#FFB6C1);border:2px solid rgba(255,255,255,0.7);box-shadow:0 4px 12px rgba(255,100,130,0.5);}
#jbtn{position:fixed;bottom:52px;right:18px;width:72px;height:72px;border-radius:50%;background:radial-gradient(circle at 40% 35%,#FFB6D9,#E0507A);border:3px solid rgba(255,255,255,0.6);font-size:28px;display:none;align-items:center;justify-content:center;cursor:pointer;z-index:30;touch-action:manipulation;box-shadow:0 6px 20px rgba(224,80,122,0.6);color:#fff;}
@media(pointer:coarse){#jzone{display:block;}#jbtn{display:flex;}}
#hint{position:fixed;bottom:8px;left:50%;transform:translateX(-50%);font-size:10px;color:rgba(80,40,60,0.45);letter-spacing:2px;pointer-events:none;font-weight:800;}
@media(pointer:coarse){#hint{display:none;}}
#deathov{position:fixed;inset:0;background:rgba(30,0,15,0.88);z-index:80;display:none;flex-direction:column;align-items:center;justify-content:center;backdrop-filter:blur(10px);}
#deathov.show{display:flex;}
#deathov h2{font-family:'Fredoka One',cursive;font-size:56px;color:#FF9EBC;margin-bottom:8px;}
#deathov p{font-size:14px;color:rgba(255,200,220,0.6);margin-bottom:28px;}
.btn-pink{font-family:'Fredoka One',cursive;font-size:18px;background:linear-gradient(135deg,#FF9EBC,#E0507A);color:#fff;border:none;border-radius:50px;padding:14px 48px;cursor:pointer;box-shadow:0 8px 22px rgba(224,80,122,0.5);}
#winov{position:fixed;inset:0;background:rgba(10,0,30,0.92);z-index:80;display:none;flex-direction:column;align-items:center;justify-content:center;backdrop-filter:blur(14px);}
#winov.show{display:flex;}
#winov h2{font-family:'Fredoka One',cursive;font-size:52px;color:#FFE44D;margin-bottom:10px;text-align:center;}
#winov p{font-size:14px;color:rgba(255,230,140,0.6);margin-bottom:28px;}
.btn-gold{font-family:'Fredoka One',cursive;font-size:18px;background:linear-gradient(135deg,#FFE44D,#FF9800);color:#5A2D00;border:none;border-radius:50px;padding:14px 48px;cursor:pointer;box-shadow:0 8px 22px rgba(255,180,0,0.5);}
</style>
</head>
<body>
<canvas id="gc"></canvas>
<div id="hud">
  <div class="chip">â¤ï¸ <span class="v" id="hpv">3</span></div>
  <div id="game-title">âœ¨ DREAMY STAR</div>
  <div class="chip">â­ <span class="v" id="starv">0</span></div>
</div>
<div id="zonech">Prairie DorÃ©e ğŸŒ¸</div>
<div id="notif"></div>
<div id="jzone"><div id="jbase"></div><div id="jknob"></div></div>
<div id="jbtn">â˜…</div>
<div id="hint">â† â†’ â†‘ â†“ / ZQSD : bouger &nbsp;|&nbsp; ESPACE : sauter</div>
<div id="deathov">
  <h2>AÃ¯e! ğŸ’”</h2>
  <p>Tu es tombÃ© dans le vide...</p>
  <button class="btn-pink" id="respawn-btn">âœ¨ RÃ©essayer</button>
</div>
<div id="winov">
  <h2>ğŸŒŸ Bravo! ğŸŒŸ</h2>
  <p id="win-msg">Tu as terminÃ© le monde des rÃªves!</p>
  <button class="btn-gold" onclick="location.reload()">ğŸ® Rejouer</button>
</div>
<script>
(function(){"use strict";

var GC=document.getElementById(â€œgcâ€), CTX=GC.getContext(â€œ2dâ€);
function resize(){GC.width=innerWidth;GC.height=innerHeight;}
resize(); addEventListener(â€œresizeâ€,resize);

// â”€â”€ ISOMETRIC PROJECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// World: x = right axis, y = forward/depth axis, z = up/altitude
// Isometric: camera looks from top-right-front
// Screen: sx = (x - y) * T,  sy = (x + y) * T*0.5 - z * T
// T = tile pixel size

var T = 48; // tile unit in pixels
var CX = 0, CY = 0; // camera scroll offset

function iso(wx, wy, wz) {
return {
sx: (wx - wy) * T - CX + GC.width * 0.5,
sy: (wx + wy) * T * 0.5 - wz * T - CY + GC.height * 0.55
};
}

// â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function clamp(v,a,b){return v<a?a:v>b?b:v;}
function lerp(a,b,t){return a+(b-a)*t;}
function lerpRGB(a,b,t){return[Math.round(a[0]+(b[0]-a[0])*t),Math.round(a[1]+(b[1]-a[1])*t),Math.round(a[2]+(b[2]-a[2])*t)];}
function shade(hex,f){var r=parseInt(hex.slice(1,3),16),g=parseInt(hex.slice(3,5),16),b=parseInt(hex.slice(5,7),16);returnâ€rgb(â€+Math.round(r*f)+â€,â€+Math.round(g*f)+â€,â€+Math.round(b*f)+â€)â€;}

// â”€â”€ THEMES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var TH={
grass: {top:â€#6DC52Aâ€,L:â€#4A8A14â€,R:â€#5AAA1Câ€},
flower:{top:â€#78D830â€,L:â€#3A7810â€,R:â€#50A020â€},
cloud: {top:â€#FFFFFFâ€,L:â€#B0CCE0â€,R:â€#C8DDF0â€},
ice:   {top:â€#A8E0FFâ€,L:â€#4880B8â€,R:â€#68A4D8â€},
stone: {top:â€#8898A8â€,L:â€#303848â€,R:â€#485868â€},
candy: {top:â€#FFB0D0â€,L:â€#B02870â€,R:â€#D84888â€},
wood:  {top:â€#C08A48â€,L:â€#603818â€,R:â€#885028â€},
dark:  {top:â€#4838A0â€,L:â€#100820â€,R:â€#201038â€},
lava:  {top:â€#FF4810â€,L:â€#AA1000â€,R:â€#CC2800â€},
goal:  {top:â€#FFD000â€,L:â€#A06000â€,R:â€#C08010â€},
};

// â”€â”€ DRAW ISOMETRIC BOX â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// (wx,wy,wz) = bottom-corner (min x,y,z). w=size x, d=size y, h=height z
function drawBox(wx,wy,wz, w,d,h, type, tick){
var th=TH[type]||TH.grass;
// Project the 8 vertices we actually need
var T00=iso(wx,  wy,  wz+h); // top face
var T10=iso(wx+w,wy,  wz+h);
var T01=iso(wx,  wy+d,wz+h);
var T11=iso(wx+w,wy+d,wz+h);
var B00=iso(wx,  wy,  wz);   // bottom corners (for side faces)
var B10=iso(wx+w,wy,  wz);
var B01=iso(wx,  wy+d,wz);
var B11=iso(wx+w,wy+d,wz);

// Cull
var allX=[T00.sx,T10.sx,T01.sx,T11.sx];
var allY=[T00.sy,T10.sy,T01.sy,T11.sy,B00.sy,B11.sy];
if(Math.max.apply(0,allX)<-60||Math.min.apply(0,allX)>GC.width+60) return;
if(Math.max.apply(0,allY)<-60||Math.min.apply(0,allY)>GC.height+60) return;

// RIGHT side face (y = wy+d side, faces right in iso)
CTX.beginPath();
CTX.moveTo(T10.sx,T10.sy); CTX.lineTo(T11.sx,T11.sy);
CTX.lineTo(B11.sx,B11.sy); CTX.lineTo(B10.sx,B10.sy);
CTX.closePath();
var rg=CTX.createLinearGradient(T10.sx,T10.sy,B10.sx,B10.sy);
if(type===â€œlavaâ€){rg.addColorStop(0,â€#CC2800â€);rg.addColorStop(1,â€#801000â€);}
else{rg.addColorStop(0,th.R);rg.addColorStop(1,shade(th.R,0.6));}
CTX.fillStyle=rg; CTX.fill();
CTX.strokeStyle=â€œrgba(0,0,0,0.1)â€; CTX.lineWidth=0.5; CTX.stroke();

// LEFT side face (x = wx side, faces left in iso)
CTX.beginPath();
CTX.moveTo(T00.sx,T00.sy); CTX.lineTo(T01.sx,T01.sy);
CTX.lineTo(B01.sx,B01.sy); CTX.lineTo(B00.sx,B00.sy);
CTX.closePath();
var lg=CTX.createLinearGradient(T00.sx,T00.sy,B00.sx,B00.sy);
if(type===â€œlavaâ€){lg.addColorStop(0,â€#AA1000â€);lg.addColorStop(1,â€#600800â€);}
else{lg.addColorStop(0,th.L);lg.addColorStop(1,shade(th.L,0.55));}
CTX.fillStyle=lg; CTX.fill();
CTX.strokeStyle=â€œrgba(0,0,0,0.1)â€; CTX.lineWidth=0.5; CTX.stroke();

// TOP face
CTX.beginPath();
CTX.moveTo(T00.sx,T00.sy); CTX.lineTo(T10.sx,T10.sy);
CTX.lineTo(T11.sx,T11.sy); CTX.lineTo(T01.sx,T01.sy);
CTX.closePath();

if(type===â€œlavaâ€){
var lp=0.5+Math.sin(tick*0.07+wx*0.3)*0.5;
var lav=CTX.createLinearGradient(T00.sx,T00.sy,T11.sx,T11.sy);
lav.addColorStop(0,â€#FF6020â€); lav.addColorStop(lp,â€#FF9040â€); lav.addColorStop(1,â€#FF4010â€);
CTX.fillStyle=lav; CTX.fill();
CTX.globalAlpha=0.12+Math.sin(tick*0.1)*0.07; CTX.fillStyle=â€#FFCC00â€; CTX.fill(); CTX.globalAlpha=1;
} else if(type===â€œcloudâ€){
CTX.fillStyle=â€#FFFâ€; CTX.fill();
drawCloudPuffs(T00,T10,T01,T11,tick);
} else {
var tg=CTX.createLinearGradient(T00.sx,T00.sy,T01.sx,T01.sy);
tg.addColorStop(0,shade(th.top,1.12)); tg.addColorStop(1,shade(th.top,0.86));
CTX.fillStyle=tg; CTX.fill();
if(type===â€œgrassâ€||type===â€œflowerâ€) drawGrassDecals(T00,T10,T01,T11,type,wx,wy,tick);
if(type===â€œiceâ€)   drawIceShimmer(T00,T10,T01,T11,tick,wx);
if(type===â€œcandyâ€) drawCandyStripes(T00,T10,T01,T11,tick);
if(type===â€œgoalâ€)  drawGoalSparkles(T00,T10,T01,T11,tick);
if(type===â€œdarkâ€)  drawDarkStars(T00,T10,T01,T11,tick,wx);
if(type===â€œstoneâ€) drawStoneCracks(T00,T10,T01,T11,wx,wy);
}
// Top edge highlight
CTX.beginPath(); CTX.moveTo(T00.sx,T00.sy); CTX.lineTo(T10.sx,T10.sy); CTX.lineTo(T11.sx,T11.sy);
CTX.strokeStyle=â€œrgba(255,255,255,0.5)â€; CTX.lineWidth=1.1; CTX.stroke();
}

function drawCloudPuffs(A,B,C,D,tick){
var pts=[[0.5,0.5,1],[0.2,0.3,0.7],[0.8,0.28,0.65],[0.5,0.2,0.6]];
pts.forEach(function(p){
var px=lerp(lerp(A.sx,B.sx,p[0]),lerp(C.sx,D.sx,p[0]),p[1]);
var py=lerp(lerp(A.sy,B.sy,p[0]),lerp(C.sy,D.sy,p[0]),p[1]);
var r=(Math.abs(B.sx-A.sx)*0.28+4)*p[2];
var cg=CTX.createRadialGradient(px-r*0.2,py-r*0.28,0,px,py,r);
cg.addColorStop(0,â€œrgba(255,255,255,0.98)â€); cg.addColorStop(0.6,â€œrgba(240,250,255,0.8)â€); cg.addColorStop(1,â€œrgba(210,235,255,0)â€);
CTX.save(); CTX.globalAlpha=0.88; CTX.fillStyle=cg; CTX.beginPath(); CTX.arc(px,py,r,0,Math.PI*2); CTX.fill(); CTX.restore();
});
}

function drawGrassDecals(A,B,C,D,type,wx,wy,tick){
var flowerCols=[â€#FF5A90â€,â€#FFD830â€,â€#FF7030â€,â€#50D890â€,â€#E060FFâ€];
var pts=[[0.2,0.3],[0.5,0.2],[0.8,0.35],[0.3,0.7],[0.65,0.65],[0.15,0.55],[0.85,0.5]];
pts.forEach(function(p,i){
var sx=lerp(lerp(A.sx,B.sx,p[0]),lerp(C.sx,D.sx,p[0]),p[1]);
var sy=lerp(lerp(A.sy,B.sy,p[0]),lerp(C.sy,D.sy,p[0]),p[1]);
if(type===â€œflowerâ€&&i%2===0){
var col=flowerCols[(Math.floor(wx+wy)+i)%flowerCols.length];
var r=5+Math.sin(tick*0.05+i)*0.4;
CTX.save(); CTX.globalAlpha=0.92;
for(var j=0;j<5;j++){var a=j*Math.PI*2/5; CTX.fillStyle=col; CTX.beginPath(); CTX.ellipse(sx+Math.cos(a)*r*0.6,sy+Math.sin(a)*r*0.6,r*0.4,r*0.27,a,0,Math.PI*2); CTX.fill();}
CTX.fillStyle=â€#FFE030â€; CTX.beginPath(); CTX.arc(sx,sy,r*0.33,0,Math.PI*2); CTX.fill();
CTX.restore();
} else {
CTX.save(); CTX.globalAlpha=0.65; CTX.strokeStyle=â€#3A8010â€; CTX.lineWidth=1.2; CTX.lineCap=â€œroundâ€;
CTX.beginPath(); CTX.moveTo(sx,sy); CTX.lineTo(sx+Math.sin(tick*0.04+i)*1.5,sy-7); CTX.stroke(); CTX.restore();
}
});
}

function drawIceShimmer(A,B,C,D,tick,wx){
CTX.save(); CTX.globalAlpha=0.22+Math.sin(tick*0.05+wx*0.5)*0.09; CTX.fillStyle=â€#fffâ€;
CTX.beginPath(); CTX.moveTo(lerp(A.sx,B.sx,0.08),lerp(A.sy,B.sy,0.08)); CTX.lineTo(lerp(A.sx,B.sx,0.55),lerp(A.sy,B.sy,0.55)); CTX.lineTo(lerp(C.sx,D.sx,0.45),lerp(C.sy,D.sy,0.45)); CTX.closePath(); CTX.fill(); CTX.restore();
}

function drawCandyStripes(A,B,C,D,tick){
CTX.save(); CTX.globalAlpha=0.18;
for(var i=0;i<4;i++){
var t=((i/4)+tick*0.002)%1;
var t2=Math.min(1,t+0.22);
CTX.fillStyle=i%2===0?â€#FF90C0â€:â€#FFD8ECâ€;
CTX.beginPath(); CTX.moveTo(lerp(A.sx,B.sx,t),lerp(A.sy,B.sy,t)); CTX.lineTo(lerp(A.sx,B.sx,t2),lerp(A.sy,B.sy,t2)); CTX.lineTo(lerp(C.sx,D.sx,t2),lerp(C.sy,D.sy,t2)); CTX.lineTo(lerp(C.sx,D.sx,t),lerp(C.sy,D.sy,t)); CTX.closePath(); CTX.fill();
}
CTX.restore();
}

function drawGoalSparkles(A,B,C,D,tick){
for(var i=0;i<5;i++){
var t=(i+0.5)/5;
var gx=lerp(lerp(A.sx,B.sx,t),lerp(C.sx,D.sx,t),0.4)+Math.sin(tick*0.08+i)*2;
var gy=lerp(lerp(A.sy,B.sy,t),lerp(C.sy,D.sy,t),0.4)+Math.cos(tick*0.06+i*1.2)*3-4;
var r=9+Math.sin(tick*0.1+i)*2;
CTX.save(); CTX.globalAlpha=0.9; CTX.fillStyle=â€#FFE44Dâ€; CTX.shadowColor=â€#FFE44Dâ€; CTX.shadowBlur=10;
CTX.translate(gx,gy); CTX.rotate(tick*0.06+i*1.25);
CTX.beginPath();
for(var s=0;s<8;s++){var a=s*Math.PI/4; var rr=s%2===0?r:r*0.42; CTX.lineTo(Math.cos(a)*rr,Math.sin(a)*rr);}
CTX.closePath(); CTX.fill(); CTX.restore();
}
CTX.shadowBlur=0;
}

function drawDarkStars(A,B,C,D,tick,wx){
CTX.save(); CTX.globalAlpha=0.7;
for(var i=0;i<4;i++){
var t=(i+0.5)/4, ty=0.2+i*0.2;
var sx=lerp(lerp(A.sx,B.sx,t),lerp(C.sx,D.sx,t),ty);
var sy=lerp(lerp(A.sy,B.sy,t),lerp(C.sy,D.sy,t),ty)+Math.sin(tick*0.05+i)*2;
var r=4+Math.sin(tick*0.07+i+wx)*1;
CTX.fillStyle=â€#C8A0FFâ€; CTX.shadowColor=â€#9050FFâ€; CTX.shadowBlur=6;
CTX.beginPath();
for(var s=0;s<10;s++){var a=s*Math.PI/5-Math.PI/2; var rr=s%2===0?r:r*0.42; if(s===0)CTX.moveTo(sx+Math.cos(a)*rr,sy+Math.sin(a)*rr); else CTX.lineTo(sx+Math.cos(a)*rr,sy+Math.sin(a)*rr);}
CTX.closePath(); CTX.fill();
}
CTX.restore(); CTX.shadowBlur=0;
}

function drawStoneCracks(A,B,C,D,wx,wy){
CTX.save(); CTX.globalAlpha=0.18; CTX.strokeStyle=â€#202830â€; CTX.lineWidth=0.8; CTX.lineCap=â€œroundâ€;
var seed=(wx*7+wy*13)%100;
CTX.beginPath();
var mx=lerp(A.sx,B.sx,0.3+seed*0.004), my=lerp(A.sy,B.sy,0.3+seed*0.004);
CTX.moveTo(mx,my); CTX.lineTo(mx+(seed%5)*2-5,my+(seed%3)*2-3); CTX.stroke();
CTX.restore();
}

// â”€â”€ LEVEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var PLATS=[], ITEMS=[], ENEMIES=[], CPS=[];
var PARTS=[], FLOATS=[];

function buildLevel(){
PLATS=[]; ITEMS=[]; ENEMIES=[]; CPS=[];

function P(x,y,z,w,d,h,t){PLATS.push({x,y,z,w,d,h,type:t});}
function S(x,y,z,t){ITEMS.push({x,y,z,type:t,done:false,bob:Math.random()*6.28});}
function SL(x,y,z,n,t){for(var i=0;i<n;i++)S(x+i*1.4,y,z,t);}
function E(x,y,z,rng,t){ENEMIES.push({x,y,z,ox:x,oy:y,rng,type:t,t:Math.random()*6.28,dead:false,bob:Math.random()*6.28});}
function CP(x,y,z){CPS.push({x,y,z,done:false});}

// ZONE 1 â€“ Prairie (x 0-18)
P(0, 0,0, 4,4,1,â€œgrassâ€);
P(5, 0,0, 4,4,1,â€œgrassâ€);
P(10,0,0, 4,4,1,â€œflowerâ€);
P(15,0,0, 4,4,1,â€œflowerâ€);
SL(1,2,2,3,â€œcoinâ€); SL(6,2,2,3,â€œcoinâ€); S(11,2,2,â€œstarâ€); S(16,2,2,â€œstarâ€);
E(6,2,1.5,1.5,â€œgreenâ€); E(16,2,1.5,1.5,â€œpinkâ€);
CP(10,2,1.5);

// ZONE 2 â€“ Nuages (x 20-40)
P(20,0,2, 3,3,0.5,â€œcloudâ€);
P(25,0,3, 3,3,0.5,â€œcloudâ€);
P(30,0,4, 3,3,0.5,â€œcloudâ€);
P(35,0,3, 3,3,0.5,â€œcloudâ€);
P(40,0,2, 3,3,0.5,â€œcloudâ€);
S(21,1.5,3.8,â€œstarâ€); S(26,1.5,4.8,â€œcoinâ€); S(31,1.5,5.8,â€œgemâ€); S(36,1.5,4.8,â€œcoinâ€); S(41,1.5,3.8,â€œstarâ€);
CP(30,1.5,5.5);

// ZONE 3 â€“ Glace (x 44-66)
P(44,0,2, 3,4,2,â€œiceâ€);
P(49,0,4, 3,4,2,â€œiceâ€);
P(54,0,6, 3,4,2,â€œiceâ€);
P(59,0,4, 3,4,2,â€œiceâ€);
P(64,0,2, 3,4,2,â€œiceâ€);
SL(45,2,5,3,â€œcoinâ€); SL(55,2,9,3,â€œstarâ€);
E(49,2,6.5,1.5,â€œiceâ€); E(59,2,6.5,1.5,â€œiceâ€);
CP(54,2,8.5);

// ZONE 4 â€“ Bonbon (x 69-87)
P(69,0,2, 3,4,1.5,â€œcandyâ€);
P(74,0,3, 3,4,1.5,â€œcandyâ€);
P(79,0,4, 3,4,1.5,â€œcandyâ€);
P(84,0,3, 3,4,1.5,â€œcandyâ€);
SL(70,2,4,3,â€œstarâ€); S(80,2,6.5,â€œgemâ€); SL(85,2,5,3,â€œcoinâ€);
E(74,2,5,â€œpinkâ€); E(84,2,5,â€œpinkâ€);
CP(79,2,6);

// ZONE 5 â€“ Forteresse (x 90-110)
P(90, 0,2, 3,4,2.5,â€œstoneâ€);
P(95, 0,3, 3,4,2.5,â€œstoneâ€);
P(100,0,4, 3,4,2.5,â€œstoneâ€);
P(105,0,3, 3,4,2.5,â€œstoneâ€);
P(110,0,2, 3,4,2.5,â€œstoneâ€);
SL(91,2,5.5,3,â€œcoinâ€); S(101,2,7.5,â€œgemâ€); SL(106,2,6,3,â€œstarâ€);
E(95,2,6.5,1.5,â€œgreyâ€); E(105,2,6.5,1.5,â€œgreyâ€);
CP(100,2,7.5);

// ZONE 6 â€“ Bois (x 114-128)
P(114,0,2, 6,3,0.4,â€œwoodâ€);
P(122,0,2, 6,3,0.4,â€œwoodâ€);
P(130,0,2, 4,4,1.5,â€œstoneâ€);
SL(114,1.5,3.5,6,â€œcoinâ€); SL(122,1.5,3.5,6,â€œcoinâ€);
CP(132,2,4);

// ZONE 7 â€“ RÃªves (x 136-156)
P(136,0,2, 3,4,2,â€œdarkâ€);
P(141,0,4, 3,4,2,â€œdarkâ€);
P(146,0,6, 3,4,2,â€œdarkâ€);
P(151,0,4, 3,4,2,â€œdarkâ€);
P(156,0,2, 3,4,2,â€œdarkâ€);
S(137,2,5,â€œgemâ€); S(142,2,7,â€œgemâ€); S(147,2,9,â€œgemâ€); S(152,2,7,â€œgemâ€); S(157,2,5,â€œgemâ€);
E(141,2,7,â€œpurpleâ€); E(151,2,7,â€œpurpleâ€);
CP(146,2,9);

// ZONE 8 â€“ Lave (x 161-181)
P(161,0,2, 2,4,1.5,â€œstoneâ€);
P(165,0,2, 2,4,1.5,â€œstoneâ€);
P(169,0,2, 2,4,1.5,â€œstoneâ€);
P(173,0,2, 2,4,1.5,â€œstoneâ€);
P(177,0,2, 2,4,1.5,â€œstoneâ€);
P(160,-1,-2, 21,6,1,â€œlavaâ€); // lava bed below
SL(162,2,4.5,2,â€œstarâ€); SL(170,2,4.5,2,â€œstarâ€); SL(174,2,4.5,2,â€œstarâ€);
CP(177,2,4);

// GOAL â€“ TrÃ©sor (x 183+)
P(183,0,2, 6,6,2,â€œgoalâ€);
for(var i=0;i<8;i++){var a=i*Math.PI*2/8; S(186+Math.cos(a)*2.8,3+Math.sin(a)*2.8,5.5,â€œgemâ€);}
CP(186,3,5.5);
}

// â”€â”€ PHYSICS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var PL={
x:2, y:2, z:2,
vx:0,vy:0,vz:0,
onGround:false, coyote:0,
jumpHeld:false,
hp:3, stars:0,
dead:false, won:false,
invT:0,
spawnX:2,spawnY:2,spawnZ:2,
wf:0,wt:0
};
var GRAV=0.025, JUMP=0.42, SPD=0.055, FRIC=0.78, IFRIC=0.94;
var KEYS={}, joyDX=0,joyDY=0,joyActive=false, mobileJump=false;
var PR=0.35; // player radius for collision

function getTopZ(px,py){
var best=null;
for(var i=0;i<PLATS.length;i++){
var p=PLATS[i];
if(px+PR<p.x||px-PR>p.x+p.w||py+PR<p.y||py-PR>p.y+p.d) continue;
var top=p.z+p.h;
if(best===null||top>best) best=top;
}
return best;
}

function getSurf(px,py,pz){
for(var i=0;i<PLATS.length;i++){
var p=PLATS[i];
if(px+PR<p.x||px-PR>p.x+p.w||py+PR<p.y||py-PR>p.y+p.d) continue;
if(Math.abs(pz-(p.z+p.h))<0.3) return p.type;
}
return null;
}

function tick_player(){
if(PL.dead||PL.won) return;
PL.invT=Math.max(0,PL.invT-1);

var ix=0,iy=0,jump=false;
if(KEYS[â€œArrowRightâ€]||KEYS[â€œKeyDâ€]) ix+=1;
if(KEYS[â€œArrowLeftâ€] ||KEYS[â€œKeyAâ€]||KEYS[â€œKeyQâ€]) ix-=1;
if(KEYS[â€œArrowDownâ€] ||KEYS[â€œKeySâ€]) iy+=1;
if(KEYS[â€œArrowUpâ€]   ||KEYS[â€œKeyWâ€]||KEYS[â€œKeyZâ€]) iy-=1;
if(KEYS[â€œSpaceâ€]||KEYS[â€œShiftLeftâ€]) jump=true;
if(mobileJump) jump=true;
if(joyActive){
var jm=Math.sqrt(joyDX*joyDX+joyDY*joyDY);
if(jm>8){ix+=joyDX/jm;iy+=joyDY/jm;}
}
if(ix&&iy){ix*=0.707;iy*=0.707;}
if(Math.abs(ix)>0.05||Math.abs(iy)>0.05){PL.wt++;if(PL.wt%5===0)PL.wf++;}else{PL.wf=0;PL.wt=0;}

var surf=getSurf(PL.x,PL.y,PL.z);
var fr=surf===â€œiceâ€?IFRIC:FRIC;
PL.vx=(PL.vx+ix*SPD)*fr;
PL.vy=(PL.vy+iy*SPD)*fr;

if(jump&&!PL.jumpHeld&&(PL.onGround||PL.coyote>0)){
PL.vz=JUMP; PL.onGround=false; PL.coyote=0; PL.jumpHeld=true;
burst(PL.x,PL.y,PL.z,â€#FFB6D9â€,6);
}
if(!jump) PL.jumpHeld=false;

PL.vz-=GRAV;
PL.x+=PL.vx;
PL.y+=PL.vy;
PL.z+=PL.vz;

var gz=getTopZ(PL.x,PL.y);
if(gz!==null&&PL.z<=gz&&PL.vz<=0){
PL.z=gz; PL.vz=0; PL.onGround=true; PL.coyote=8;
if(getSurf(PL.x,PL.y,PL.z)===â€œlavaâ€&&PL.invT===0) hurt(1,â€#FF5020â€,â€œğŸ”¥ BrÃ»lÃ©!â€);
} else {
if(PL.coyote>0) PL.coyoteâ€“; else PL.onGround=false;
}
if(PL.z<-8) die();

// Camera follows player
var sp=iso(PL.x,PL.y,PL.z);
CX+=(sp.sx-GC.width*0.5)*0.1;
CY+=(sp.sy-GC.height*0.55)*0.1;
}

function hurt(d,col,msg){
if(PL.invT>0) return;
PL.hp-=d; PL.invT=90;
document.getElementById(â€œhpvâ€).textContent=PL.hp;
var sp=iso(PL.x,PL.y,PL.z+1);
floatText(sp.sx,sp.sy,msg,col);
burst(PL.x,PL.y,PL.z,col,8);
if(PL.hp<=0) die();
}

function die(){
if(PL.dead) return;
PL.dead=true;
burst(PL.x,PL.y,PL.z,â€#FF9EBCâ€,16);
setTimeout(function(){document.getElementById(â€œdeathovâ€).classList.add(â€œshowâ€);},400);
}

document.getElementById(â€œrespawn-btnâ€).addEventListener(â€œclickâ€,function(){
document.getElementById(â€œdeathovâ€).classList.remove(â€œshowâ€);
PL.x=PL.spawnX; PL.y=PL.spawnY; PL.z=PL.spawnZ;
PL.vx=0; PL.vy=0; PL.vz=0; PL.dead=false; PL.hp=3; PL.invT=90;
document.getElementById(â€œhpvâ€).textContent=3;
var sp=iso(PL.x,PL.y,PL.z); CX=sp.sx-GC.width*0.5; CY=sp.sy-GC.height*0.55;
});

// â”€â”€ ITEMS / ENEMIES / CPS / GOAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function tick_items(){
ITEMS.forEach(function(s){
if(s.done) return;
s.bob+=0.07;
var dx=PL.x-s.x,dy=PL.y-s.y,dz=PL.z-s.z;
if(dx*dx+dy*dy+dz*dz<1.5){
s.done=true;
var pts=s.type===â€œgemâ€?3:1;
PL.stars+=pts;
document.getElementById(â€œstarvâ€).textContent=PL.stars;
var sp=iso(s.x,s.y,s.z);
var col=s.type===â€œgemâ€?â€#CE93D8â€:s.type===â€œstarâ€?â€#FFE44Dâ€:â€#60A5FAâ€;
var msg=s.type===â€œgemâ€?â€œğŸ’ +3â€:s.type===â€œstarâ€?â€œâ­ +1â€:â€œğŸª™ +1â€;
floatText(sp.sx,sp.sy,msg,col); burst(s.x,s.y,s.z,col,s.type===â€œgemâ€?14:8);
}
});
}

var ECOLS={green:â€#50E090â€,blue:â€#60A8FFâ€,pink:â€#FF9EBCâ€,ice:â€#A0D8FFâ€,grey:â€#A0A8B0â€,purple:â€#C890E8â€};
function tick_enemies(){
ENEMIES.forEach(function(e){
if(e.dead) return;
e.t+=0.025; e.bob+=0.07;
e.x=e.ox+Math.sin(e.t)*e.rng;
if(PL.invT>0||PL.dead) return;
var dx=PL.x-e.x,dy=PL.y-e.y,dz=PL.z-e.z;
if(dx*dx+dy*dy<1.5&&Math.abs(dz)<1.5){
if(PL.vz<-0.05&&PL.z>e.z+0.8){
e.dead=true; PL.vz=JUMP*0.7;
burst(e.x,e.y,e.z+0.5,ECOLS[e.type]||â€#fffâ€,12);
var sp=iso(e.x,e.y,e.z+1); floatText(sp.sx,sp.sy,â€œğŸ’¥ Ã‰crasÃ©!â€,â€#FFE44Dâ€);
} else { hurt(1,ECOLS[e.type]||â€#FF6060â€,â€œğŸ’« AÃ¯e!â€); }
}
});
}

function tick_cps(){
CPS.forEach(function(ck){
if(ck.done) return;
if((PL.x-ck.x)**2+(PL.y-ck.y)**2<2&&Math.abs(PL.z-ck.z)<2){
ck.done=true; PL.spawnX=ck.x; PL.spawnY=ck.y; PL.spawnZ=ck.z+0.5;
notify(â€œâœ” Checkpoint!â€,â€#64B5F6â€); burst(ck.x,ck.y,ck.z,â€#64B5F6â€,10);
}
});
}

function tick_goal(){
if(PL.won) return;
PLATS.forEach(function(p){
if(p.type!==â€œgoalâ€) return;
if(PL.x>=p.x&&PL.x<=p.x+p.w&&PL.y>=p.y&&PL.y<=p.y+p.d&&Math.abs(PL.z-(p.z+p.h))<2){
PL.won=true;
document.getElementById(â€œwin-msgâ€).textContent=â€œâœ¨ â€œ+PL.stars+â€ Ã©toiles collectÃ©es! âœ¨â€;
burst(PL.x,PL.y,PL.z,â€#FFD800â€,28);
setTimeout(function(){document.getElementById(â€œwinovâ€).classList.add(â€œshowâ€);},700);
}
});
}

var ZONES=[
{f:0,  t:20, n:â€œPrairie DorÃ©e ğŸŒ¸â€},
{f:20, t:44, n:â€œÃles des Nuages â˜ï¸â€},
{f:44, t:69, n:â€œMonts GlacÃ©s â„ï¸â€},
{f:69, t:90, n:â€œPays Bonbon ğŸ­â€},
{f:90, t:114,n:â€œForteresse ğŸ°â€},
{f:114,t:136,n:â€œPonts de Bois ğŸªµâ€},
{f:136,t:161,n:â€œMonde des RÃªves ğŸŒ™â€},
{f:161,t:183,n:â€œTraversÃ©e de Lave ğŸ”¥â€},
{f:183,t:999,n:â€œÃle du TrÃ©sor ğŸ‘‘â€},
];
var lastZone=â€â€;
function tick_zone(){
ZONES.forEach(function(z){
if(PL.x>=z.f&&PL.x<z.t&&z.n!==lastZone){lastZone=z.n;document.getElementById(â€œzonechâ€).textContent=z.n;notify(z.n,â€#FF9EBCâ€);}
});
}

// â”€â”€ PARTICLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function burst(wx,wy,wz,col,n){
var sp=iso(wx,wy,wz);
for(var i=0;i<n;i++){var a=(Math.PI*2/n)*i+Math.random()*0.4,spd=2+Math.random()*3;PARTS.push({sx:sp.sx,sy:sp.sy,vx:Math.cos(a)*spd,vy:Math.sin(a)*spd-1,col,life:45+Math.random()*18,maxLife:63,r:2+Math.random()*3});}
}
function floatText(sx,sy,txt,col){FLOATS.push({sx,sy,txt,col,life:75,maxLife:75,vy:-1.1});}
function drawFX(){
for(var i=PARTS.length-1;i>=0;iâ€“){var p=PARTS[i];p.sx+=p.vx;p.sy+=p.vy;p.vx*=0.88;p.vy=p.vy*0.88+0.07;p.lifeâ€“;if(p.life<=0){PARTS.splice(i,1);continue;}CTX.globalAlpha=p.life/p.maxLife;CTX.fillStyle=p.col;CTX.shadowColor=p.col;CTX.shadowBlur=4;CTX.beginPath();CTX.arc(p.sx,p.sy,p.r,0,Math.PI*2);CTX.fill();}
for(var i=FLOATS.length-1;i>=0;iâ€“){var f=FLOATS[i];f.sy+=f.vy;f.lifeâ€“;if(f.life<=0){FLOATS.splice(i,1);continue;}CTX.globalAlpha=Math.min(1,f.life/22);CTX.fillStyle=f.col;CTX.shadowColor=f.col;CTX.shadowBlur=6;CTX.font=â€œbold 14px â€˜Nunitoâ€™,sans-serifâ€;CTX.textAlign=â€œcenterâ€;CTX.fillText(f.txt,f.sx,f.sy);}
CTX.globalAlpha=1;CTX.shadowBlur=0;CTX.textAlign=â€œleftâ€;
}

// â”€â”€ DRAW ITEM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function drawItem(s,tick){
if(s.done) return;
var bob=Math.sin(s.bob+tick*0.06)*0.22;
var sp=iso(s.x,s.y,s.z+bob);
if(sp.sx<-60||sp.sx>GC.width+60||sp.sy<-60||sp.sy>GC.height+60) return;
var r=s.type===â€œgemâ€?12:s.type===â€œstarâ€?11:9;
var col=s.type===â€œgemâ€?â€#D060F0â€:s.type===â€œstarâ€?â€#FFE030â€:â€#60A5FAâ€;
var lite=s.type===â€œgemâ€?â€#F0A0FFâ€:s.type===â€œstarâ€?â€#FFFFF0â€:â€#A0CFFFâ€;
var dark=s.type===â€œgemâ€?â€#6010A0â€:s.type===â€œstarâ€?â€#C07000â€:â€#1040A0â€;
CTX.save(); CTX.shadowColor=col; CTX.shadowBlur=r*0.9;
var g=CTX.createRadialGradient(sp.sx-r*0.3,sp.sy-r*0.35,0,sp.sx,sp.sy,r);
g.addColorStop(0,lite); g.addColorStop(0.4,col); g.addColorStop(1,dark);
CTX.fillStyle=g;
if(s.type===â€œstarâ€){CTX.beginPath();for(var i=0;i<10;i++){var a=i*Math.PI/5-Math.PI/2,rr=i%2===0?r:r*0.42;if(i===0)CTX.moveTo(sp.sx+Math.cos(a)*rr,sp.sy+Math.sin(a)*rr);else CTX.lineTo(sp.sx+Math.cos(a)*rr,sp.sy+Math.sin(a)*rr);}CTX.closePath();CTX.fill();}
else if(s.type===â€œgemâ€){CTX.beginPath();CTX.moveTo(sp.sx,sp.sy-r);CTX.lineTo(sp.sx+r*0.75,sp.sy-r*0.2);CTX.lineTo(sp.sx+r*0.5,sp.sy+r);CTX.lineTo(sp.sx-r*0.5,sp.sy+r);CTX.lineTo(sp.sx-r*0.75,sp.sy-r*0.2);CTX.closePath();CTX.fill();}
else{CTX.beginPath();CTX.arc(sp.sx,sp.sy,r,0,Math.PI*2);CTX.fill();}
CTX.globalAlpha=0.45;CTX.fillStyle=â€#fffâ€;CTX.beginPath();CTX.ellipse(sp.sx-r*0.28,sp.sy-r*0.3,r*0.22,r*0.14,-0.4,0,Math.PI*2);CTX.fill();
CTX.restore();
}

// â”€â”€ DRAW ENEMY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function drawEnemy(e,tick){
if(e.dead) return;
var bob=Math.sin(e.bob+tick*0.07)*0.15;
var sp=iso(e.x,e.y,e.z+0.5+bob);
if(sp.sx<-80||sp.sx>GC.width+80||sp.sy<-80||sp.sy>GC.height+80) return;
var col=ECOLS[e.type]||â€#A0C0FFâ€;
var r=16;
CTX.save(); CTX.shadowColor=col; CTX.shadowBlur=r*0.35;
// Shadow
CTX.globalAlpha=0.18;CTX.fillStyle=â€#280A20â€;CTX.beginPath();CTX.ellipse(sp.sx,sp.sy+r*0.82,r*1.1,r*0.3,0,0,Math.PI*2);CTX.fill();CTX.globalAlpha=1;
// Body
var bg=CTX.createRadialGradient(sp.sx-r*0.28,sp.sy-r*0.32,0,sp.sx,sp.sy,r);
bg.addColorStop(0,shade(col,1.32));bg.addColorStop(0.55,col);bg.addColorStop(1,shade(col,0.55));
CTX.fillStyle=bg;CTX.beginPath();CTX.arc(sp.sx,sp.sy,r,0,Math.PI*2);CTX.fill();CTX.shadowBlur=0;
// Shine
CTX.globalAlpha=0.35;CTX.fillStyle=â€#fffâ€;CTX.beginPath();CTX.ellipse(sp.sx-r*0.28,sp.sy-r*0.34,r*0.26,r*0.16,-0.4,0,Math.PI*2);CTX.fill();CTX.globalAlpha=1;
// Eyes
CTX.fillStyle=â€#fffâ€;CTX.beginPath();CTX.ellipse(sp.sx-r*0.3,sp.sy-r*0.1,r*0.28,r*0.34,0,0,Math.PI*2);CTX.fill();
CTX.fillStyle=â€#fffâ€;CTX.beginPath();CTX.ellipse(sp.sx+r*0.3,sp.sy-r*0.1,r*0.28,r*0.34,0,0,Math.PI*2);CTX.fill();
CTX.fillStyle=â€#1A0A30â€;CTX.beginPath();CTX.arc(sp.sx-r*0.24,sp.sy-r*0.08,r*0.17,0,Math.PI*2);CTX.fill();
CTX.fillStyle=â€#1A0A30â€;CTX.beginPath();CTX.arc(sp.sx+r*0.36,sp.sy-r*0.08,r*0.17,0,Math.PI*2);CTX.fill();
CTX.fillStyle=â€#fffâ€;CTX.beginPath();CTX.arc(sp.sx-r*0.17,sp.sy-r*0.17,r*0.07,0,Math.PI*2);CTX.fill();
CTX.fillStyle=â€#fffâ€;CTX.beginPath();CTX.arc(sp.sx+r*0.43,sp.sy-r*0.17,r*0.07,0,Math.PI*2);CTX.fill();
// Feet
CTX.fillStyle=shade(col,0.7);
CTX.beginPath();CTX.ellipse(sp.sx-r*0.36,sp.sy+r*0.76,r*0.27,r*0.17,0.15,0,Math.PI*2);CTX.fill();
CTX.beginPath();CTX.ellipse(sp.sx+r*0.36,sp.sy+r*0.76,r*0.27,r*0.17,-0.15,0,Math.PI*2);CTX.fill();
CTX.restore();
}

// â”€â”€ DRAW CHECKPOINT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function drawCP(ck,tick){
var sp=iso(ck.x,ck.y,ck.z);
if(sp.sx<-100||sp.sx>GC.width+100) return;
CTX.save();
CTX.strokeStyle=ck.done?â€#64B5F6â€:â€œrgba(255,255,255,0.4)â€;CTX.lineWidth=2.5;CTX.lineCap=â€œroundâ€;
CTX.beginPath();CTX.moveTo(sp.sx,sp.sy);CTX.lineTo(sp.sx,sp.sy-55);CTX.stroke();
var wave=Math.sin(tick*0.08)*5;
CTX.fillStyle=ck.done?â€#64B5F6â€:â€œrgba(255,255,255,0.3)â€;
if(ck.done){CTX.shadowColor=â€#64B5F6â€;CTX.shadowBlur=12;}
CTX.beginPath();CTX.moveTo(sp.sx,sp.sy-55);CTX.lineTo(sp.sx+22+wave,sp.sy-46);CTX.lineTo(sp.sx,sp.sy-36);CTX.closePath();CTX.fill();
CTX.restore();CTX.shadowBlur=0;
}

// â”€â”€ DRAW PLAYER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function drawPlayer(tick){
if(PL.dead) return;
if(PL.invT>0&&Math.floor(PL.invT/6)%2===0) return;
var sp=iso(PL.x,PL.y,PL.z);
if(sp.sx<-80||sp.sx>GC.width+80) return;
var r=20;
var sqX=PL.onGround?1.1:0.86, sqY=PL.onGround?0.9:1.22;
if(PL.vz>0.1){sqX=0.76;sqY=1.28;}
// Shadow on ground
var gz=getTopZ(PL.x,PL.y);
if(gz!==null){
var gsp=iso(PL.x,PL.y,gz);
var dist=clamp(PL.z-gz,0,5);
CTX.save();CTX.globalAlpha=Math.max(0,0.22-dist*0.03);CTX.fillStyle=â€#1A0830â€;
CTX.beginPath();CTX.ellipse(gsp.sx,gsp.sy+2,r*sqX*(1-dist*0.08),r*0.28,0,0,Math.PI*2);CTX.fill();CTX.restore();
}
CTX.save();CTX.translate(sp.sx,sp.sy);CTX.scale(sqX,sqY);
if(!PL.onGround){CTX.globalAlpha=0.11;CTX.shadowColor=â€#FF9EBCâ€;CTX.shadowBlur=r*1.5;CTX.fillStyle=â€#FF9EBCâ€;CTX.beginPath();CTX.arc(0,0,r*1.7,0,Math.PI*2);CTX.fill();CTX.globalAlpha=1;CTX.shadowBlur=0;}
CTX.shadowColor=â€œrgba(0,0,0,0.25)â€;CTX.shadowBlur=r*0.4;
var bg=CTX.createRadialGradient(-r*0.32,-r*0.38,0,r*0.08,r*0.08,r);
bg.addColorStop(0,â€#FFCCE2â€);bg.addColorStop(0.42,â€#FF9EBCâ€);bg.addColorStop(1,â€#DC4080â€);
CTX.fillStyle=bg;CTX.beginPath();CTX.arc(0,0,r,0,Math.PI*2);CTX.fill();CTX.shadowBlur=0;
CTX.globalAlpha=0.28;CTX.fillStyle=â€#FF5080â€;
CTX.beginPath();CTX.ellipse(-r*0.52,r*0.28,r*0.32,r*0.19,0.2,0,Math.PI*2);CTX.fill();
CTX.beginPath();CTX.ellipse(r*0.52,r*0.28,r*0.32,r*0.19,-0.2,0,Math.PI*2);CTX.fill();
CTX.globalAlpha=0.4;CTX.fillStyle=â€#fffâ€;CTX.beginPath();CTX.ellipse(-r*0.29,-r*0.34,r*0.28,r*0.16,-0.5,0,Math.PI*2);CTX.fill();CTX.globalAlpha=1;
CTX.fillStyle=â€#fffâ€;CTX.shadowColor=â€#000â€;CTX.shadowBlur=2;
CTX.beginPath();CTX.ellipse(-r*0.29,-r*0.1,r*0.32,r*0.38,0,0,Math.PI*2);CTX.fill();
CTX.beginPath();CTX.ellipse(r*0.29,-r*0.1,r*0.32,r*0.38,0,0,Math.PI*2);CTX.fill();
CTX.shadowBlur=0;
CTX.fillStyle=â€#1A237Eâ€;CTX.beginPath();CTX.arc(-r*0.23,-r*0.08,r*0.22,0,Math.PI*2);CTX.fill();
CTX.fillStyle=â€#1A237Eâ€;CTX.beginPath();CTX.arc(r*0.35,-r*0.08,r*0.22,0,Math.PI*2);CTX.fill();
CTX.fillStyle=â€#5C6BC0â€;CTX.beginPath();CTX.arc(-r*0.21,-r*0.11,r*0.15,0,Math.PI*2);CTX.fill();
CTX.fillStyle=â€#5C6BC0â€;CTX.beginPath();CTX.arc(r*0.37,-r*0.11,r*0.15,0,Math.PI*2);CTX.fill();
CTX.fillStyle=â€#fffâ€;CTX.beginPath();CTX.arc(-r*0.13,-r*0.21,r*0.06,0,Math.PI*2);CTX.fill();
CTX.fillStyle=â€#fffâ€;CTX.beginPath();CTX.arc(r*0.45,-r*0.21,r*0.06,0,Math.PI*2);CTX.fill();
CTX.strokeStyle=â€#B02858â€;CTX.lineWidth=r*0.1;CTX.lineCap=â€œroundâ€;
if(!PL.onGround&&PL.vz>0.08){CTX.fillStyle=â€#B02858â€;CTX.beginPath();CTX.ellipse(0,r*0.44,r*0.13,r*0.17,0,0,Math.PI*2);CTX.fill();}
else if(PL.wf>0){CTX.beginPath();CTX.arc(0,r*0.4,r*0.35,0.15,Math.PI-0.15);CTX.stroke();}
else{CTX.beginPath();CTX.arc(0,r*0.44,r*0.24,0.3,Math.PI-0.3);CTX.stroke();}
var as=PL.onGround?Math.sin(PL.wf*0.9)*0.45:0.6;
CTX.fillStyle=â€#FF9EBCâ€;CTX.shadowColor=â€œrgba(0,0,0,0.1)â€;CTX.shadowBlur=3;
CTX.beginPath();CTX.ellipse(-r*0.88,r*0.06,r*0.3,r*0.2,0.85+as,0,Math.PI*2);CTX.fill();
CTX.beginPath();CTX.ellipse(r*0.88,r*0.06,r*0.3,r*0.2,-0.85-as,0,Math.PI*2);CTX.fill();
CTX.shadowBlur=0;CTX.fillStyle=â€#DC4080â€;
var fo=PL.onGround?Math.sin(PL.wf*0.9)*r*0.08:0;
CTX.beginPath();CTX.ellipse(-r*0.36,r*0.8+fo,r*0.28,r*0.17,0.18,0,Math.PI*2);CTX.fill();
CTX.beginPath();CTX.ellipse(r*0.36,r*0.8-fo,r*0.28,r*0.17,-0.18,0,Math.PI*2);CTX.fill();
if(!PL.onGround&&PL.vz>0.05){CTX.fillStyle=â€#FFE044â€;CTX.globalAlpha=0.85;CTX.shadowColor=â€#FFE044â€;CTX.shadowBlur=8;for(var i=0;i<4;i++){var aa=tick*0.12+i*Math.PI/2;CTX.beginPath();CTX.arc(Math.cos(aa)*r*1.5,Math.sin(aa)*r*1.5,2.5,0,Math.PI*2);CTX.fill();}CTX.globalAlpha=1;CTX.shadowBlur=0;}
CTX.restore();
}

// â”€â”€ BACKGROUND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function drawBG(tick){
var prog=clamp(PL.x/183,0,1);
var c1=lerpRGB([135,200,240],[60,40,120],prog);
var c2=lerpRGB([200,160,220],[100,50,160],prog);
var sky=CTX.createLinearGradient(0,0,0,GC.height);
sky.addColorStop(0,â€œrgb(â€+c1+â€)â€); sky.addColorStop(1,â€œrgb(â€+c2+â€)â€);
CTX.fillStyle=sky; CTX.fillRect(0,0,GC.width,GC.height);
if(prog>0.55){CTX.save();CTX.globalAlpha=(prog-0.55)*2.2;for(var i=0;i<35;i++){var bx=(i*173)%GC.width,by=(i*109)%(GC.height*0.55);CTX.fillStyle=â€œrgba(255,255,255,â€+(0.4+Math.sin(tick*0.04+i)*0.3)+â€)â€;CTX.beginPath();CTX.arc(bx,by,1+(i%2),0,Math.PI*2);CTX.fill();}CTX.restore();}
var sx=GC.width*0.78,sy=GC.height*0.12,sr=prog>0.6?24:20;
var sc=prog>0.6?â€œrgba(200,200,255,0.35)â€:â€œrgba(255,240,150,0.4)â€;
var sg=CTX.createRadialGradient(sx,sy,0,sx,sy,sr*6);sg.addColorStop(0,sc);sg.addColorStop(1,â€œtransparentâ€);
CTX.fillStyle=sg;CTX.fillRect(0,0,GC.width,GC.height);
CTX.fillStyle=prog>0.6?â€#D0D8FFâ€:â€#FFFCE0â€;CTX.shadowColor=CTX.fillStyle;CTX.shadowBlur=18;
CTX.beginPath();CTX.arc(sx,sy,sr,0,Math.PI*2);CTX.fill();CTX.shadowBlur=0;
for(var i=0;i<5;i++){
var cx=((i*280+tick*0.3-CX*0.08)%(GC.width+350))-175;
var cy=GC.height*(0.08+i*0.05),cr=30+i*14;
CTX.save();CTX.globalAlpha=0.36+i*0.04;
[[0,0,1],[-.5,-.35,.7],[.5,-.3,.65],[0,-.45,.6]].forEach(function(p){
var px=cx+p[0]*cr,py=cy+p[1]*cr,pr=cr*p[2]*0.6;
var cg=CTX.createRadialGradient(px,py,0,px,py,pr);cg.addColorStop(0,â€œrgba(255,255,255,0.95)â€);cg.addColorStop(0.55,â€œrgba(240,248,255,0.75)â€);cg.addColorStop(1,â€œtransparentâ€);
CTX.fillStyle=cg;CTX.beginPath();CTX.arc(px,py,pr,0,Math.PI*2);CTX.fill();
});
CTX.restore();
}
}

var notifT=0;
function notify(txt,col){var el=document.getElementById(â€œnotifâ€);el.textContent=txt;el.style.color=col||â€#FF5FA0â€;el.style.opacity=â€œ1â€;notifT=160;}

// â”€â”€ MAIN LOOP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var tick=0;
function loop(){
tick++;
CTX.clearRect(0,0,GC.width,GC.height);
drawBG(tick);

// Sort: draw boxes with highest (x+y) first (furthest in iso view)
var sp=PLATS.slice().sort(function(a,b){return(b.x+b.y)-(a.x+a.y);});
sp.forEach(function(p){drawBox(p.x,p.y,p.z,p.w,p.d,p.h,p.type,tick);});

// Goal label
PLATS.forEach(function(p){
if(p.type!==â€œgoalâ€) return;
var s=iso(p.x+p.w*0.5,p.y+p.d*0.5,p.z+p.h+0.5+Math.sin(tick*0.06)*0.15);
if(s.sx<-120||s.sx>GC.width+120) return;
CTX.save();CTX.font=â€œbold 22px â€˜Fredoka Oneâ€™,cursiveâ€;CTX.textAlign=â€œcenterâ€;CTX.fillStyle=â€#FFD800â€;CTX.shadowColor=â€#FFD800â€;CTX.shadowBlur=18;CTX.fillText(â€œğŸ FIN! ğŸâ€,s.sx,s.sy);CTX.shadowBlur=0;CTX.restore();
});

CPS.forEach(function(ck){drawCP(ck,tick);});
ITEMS.slice().sort(function(a,b){return(b.x+b.y)-(a.x+a.y);}).forEach(function(s){drawItem(s,tick);});
ENEMIES.slice().sort(function(a,b){return(b.x+b.y)-(a.x+a.y);}).forEach(function(e){drawEnemy(e,tick);});

drawPlayer(tick);
drawFX();

// Vignette
var vg=CTX.createRadialGradient(GC.width*.5,GC.height*.5,GC.height*.2,GC.width*.5,GC.height*.5,GC.height*.88);
vg.addColorStop(0,â€œtransparentâ€);vg.addColorStop(1,â€œrgba(10,0,20,0.32)â€);
CTX.fillStyle=vg;CTX.fillRect(0,0,GC.width,GC.height);

if(notifT>0){notifTâ€“;document.getElementById(â€œnotifâ€).style.opacity=(notifT<40?notifT/40:1).toFixed(2);}
if(!PL.dead&&!PL.won){tick_player();tick_items();tick_enemies();tick_cps();tick_goal();tick_zone();}
requestAnimationFrame(loop);
}

// â”€â”€ INPUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
addEventListener(â€œkeydownâ€,function(e){KEYS[e.code]=true;if([â€œSpaceâ€,â€œArrowUpâ€,â€œArrowDownâ€,â€œArrowLeftâ€,â€œArrowRightâ€].includes(e.code))e.preventDefault();});
addEventListener(â€œkeyupâ€,function(e){KEYS[e.code]=false;});
var jzone=document.getElementById(â€œjzoneâ€),jknob=document.getElementById(â€œjknobâ€);
var joyStartX=0,joyStartY=0,JR=46;
jzone.addEventListener(â€œtouchstartâ€,function(e){e.preventDefault();joyActive=true;var rc=jzone.getBoundingClientRect();joyStartX=rc.left+rc.width/2;joyStartY=rc.top+rc.height/2;},{passive:false});
addEventListener(â€œtouchmoveâ€,function(e){if(!joyActive)return;e.preventDefault();var t=e.touches[0];joyDX=t.clientX-joyStartX;joyDY=t.clientY-joyStartY;var m=Math.sqrt(joyDX*joyDX+joyDY*joyDY),cl=Math.min(m,JR),a=Math.atan2(joyDY,joyDX);jknob.style.transform=â€œtranslate(calc(-50% + â€œ+Math.cos(a)*cl+â€œpx),calc(-50% + â€œ+Math.sin(a)*cl+â€œpx))â€;},{passive:false});
addEventListener(â€œtouchendâ€,function(){joyActive=false;joyDX=0;joyDY=0;jknob.style.transform=â€œtranslate(-50%,-50%)â€;});
var jbtn=document.getElementById(â€œjbtnâ€);
jbtn.addEventListener(â€œtouchstartâ€,function(e){e.preventDefault();mobileJump=true;},{passive:false});
jbtn.addEventListener(â€œtouchendâ€,function(e){e.preventDefault();mobileJump=false;},{passive:false});
jbtn.addEventListener(â€œmousedownâ€,function(){mobileJump=true;});
addEventListener(â€œmouseupâ€,function(){mobileJump=false;});

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
buildLevel();
var p0=PLATS[0];
PL.x=p0.x+p0.w*0.5; PL.y=p0.y+p0.d*0.5; PL.z=p0.z+p0.h;
PL.spawnX=PL.x; PL.spawnY=PL.y; PL.spawnZ=PL.z;
var initSP=iso(PL.x,PL.y,PL.z); CX=initSP.sx-GC.width*0.5; CY=initSP.sy-GC.height*0.55;
notify(â€œâœ¨ Bienvenue dans Dreamy Star!â€,â€#FF9EBCâ€);
requestAnimationFrame(loop);

})();
</script>

</body>
</html>
